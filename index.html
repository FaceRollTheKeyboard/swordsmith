<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>飞行者</title>
    <script src="three.js"></script>
    <style>
        body{
            padding:0px;
            margin: 0px;
            box-sizing: border-box;
        }
        #world {
            position: absolute;
            width: 100%;
            height: 100%;
            overflow: hidden;
            background: linear-gradient(#e4e0ba, #f7d9aa);
        }
    </style>
</head>
<body onload="init()">
<div id="world"></div>

<script src="Scene.js"></script>
<script src="Lights.js"></script>
<script src="Plane.js"></script>
<script src="Sea.js"></script>
<script src="Sky.js"></script>
<script>
    //定义色彩
    var Colors = {
        red:0xf25346,
        white:0xd8d0d1,
        brown:0x59332e,
        pink:0xF5986E,
        brownDark:0x23190f,
        blue:0x68c3c0
    };

    function init() {
        // 创建场景，相机和渲染器
        createScene();
        // 添加光源
        createLights();
        // 添加对象
        createPlane();
        createSea();
        createSky();

        renderer.render(scene, camera);

        //添加监听器
        document.addEventListener('mousemove', handleMouseMove, false);

        // 调用循环函数，在每帧更新对象的位置和渲染场景
        loop();
    }

    function loop(){
        sea.mesh.rotation.z += .005;
        sky.mesh.rotation.z += .01;

        // 更新每帧的飞机
        updatePlane();
        airplane.pilot.updateHairs();

        renderer.render(scene, camera);
        requestAnimationFrame(loop);
    }

    function updatePlane(){

        // 让我们在x轴上-100至100之间和y轴25至175之间移动飞机
        // 根据鼠标的位置在-1与1之间的范围，我们使用的 normalize 函数实现（如下）

        var targetX = normalize(mousePos.x, -1, 1, -100, 100);
        var targetY = normalize(mousePos.y, -1, 1, 25, 175);

        // 更新飞机的位置
        airplane.mesh.position.y = targetY;
        airplane.mesh.position.x = targetX;
        airplane.propeller.rotation.x += 0.3;
    }

    function normalize(v,vmin,vmax,tmin, tmax){

        var nv = Math.max(Math.min(v,vmax), vmin);
        var dv = vmax-vmin;
        var pc = (nv-vmin)/dv;
        var dt = tmax-tmin;
        var tv = tmin + (pc*dt);
        return tv;
    }

    var mousePos={x:0, y:0};

    // mousemove 事件处理函数

    function handleMouseMove(event) {

        // 这里我把接收到的鼠标位置的值转换成归一化值，在-1与1之间变化
        // 这是x轴的公式:

        var tx = -1 + (event.clientX / WIDTH)*2;

        // 对于 y 轴，我们需要一个逆公式
        // 因为 2D 的 y 轴与 3D 的 y 轴方向相反

        var ty = 1 - (event.clientY / HEIGHT)*2;
        mousePos = {x:tx, y:ty};
    }

</script>

</body>
</html>